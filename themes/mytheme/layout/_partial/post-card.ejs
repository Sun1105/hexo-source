<!--
  _partial/post-card.ejs
  功能：
    - 渲染单篇文章的卡片
    - 包含标题、发布日期、分类、标签、摘要、阅读全文按钮
    - 可在分类页、标签页、归档页复用
-->

<article class="post-card">
  <!-- 单篇文章卡片容器，用于布局和样式 -->

  <!-- 文章标题 -->
  <h3 class="post-title">
    <a href="<%= url_for(post.path) %>"><%= post.title %></a>
    <!-- 链接到文章详情页 -->
    <!-- url_for(post.path) → 生成文章路径 -->
    <!-- post.title → 当前文章标题 -->
  </h3>

  <!-- 文章元信息：发布日期 + 分类 + 标签 -->
  <p class="post-meta">
    发布于 <%= date(post.date, 'YYYY-MM-DD') %>
    <!-- 显示文章发布日期 -->

    <% if (post.categories && post.categories.length) { %> |
      分类：
      <% post.categories.each(function(cat, i){ %>
        <a href="<%= url_for(cat.path) %>"><%= cat.name %></a>
        <%= i < post.categories.length - 1 ? ',' : '' %>
        <!-- 遍历文章分类 -->
        <!-- 多个分类用逗号分隔 -->
      <% }); %>
    <% } %>

    <% if (post.tags && post.tags.length) { %> |
      标签：
      <% post.tags.each(function(tag, i){ %>
        <a href="<%= url_for(tag.path) %>"><%= tag.name %></a>
        <%= i < post.tags.length - 1 ? ',' : '' %>
        <!-- 遍历文章标签 -->
        <!-- 多个标签用逗号分隔 -->
      <% }); %>
    <% } %>
  </p>
  <!-- 文章元信息结束 -->

  <!-- 文章摘要 -->
  <p class="post-excerpt">
    <% 
      var excerptText = '';
      if (post.description) {
        excerptText = post.description;
      } else if (post.excerpt) {
        excerptText = strip_html(post.excerpt);
      } else if (post.content) {
        excerptText = strip_html(post.content).substring(0, 150);
      }
      
      if (excerptText && excerptText.length > 100) {
        excerptText = excerptText.substring(0, 100) + '...';
      }
    %>
    <%= excerptText || '（暂无摘要）' %>
  </p>

  <!-- 操作按钮容器 -->
  <div class="post-actions">
    <!-- 阅读全文按钮 -->
    <a href="<%= url_for(post.path) %>" class="read-more">阅读全文 →</a>
    <!-- 编辑按钮 -->
    <button onclick="openEditor('<%= post.source.replace(/\\/g, '/') %>')" class="read-more">✏️ 编辑</button>
  </div>
  <!-- 链接到文章详情页 -->
  <!-- CSS class "read-more" 用于样式化按钮 -->

</article>
<!-- 单篇文章卡片结束 -->
