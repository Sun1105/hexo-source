<!--
  category.ejs
  åˆ†ç±»é¡µé¢æ¨¡æ¿
  åŠŸèƒ½ï¼š
    - æ˜¾ç¤ºåˆ†ç±»æ ‡é¢˜
    - éå†å½“å‰åˆ†ç±»ä¸‹æ‰€æœ‰æ–‡ç« 
    - æ¸²æŸ“æ–‡ç« å¡ç‰‡åˆ—è¡¨
    - å½“åˆ†ç±»ä¸‹æ— æ–‡ç« æ—¶æ˜¾ç¤ºæç¤º
-->

<section class="main-section">
  <!-- é¡µé¢ä¸»å®¹å™¨ï¼Œæ§åˆ¶å¸ƒå±€å’Œæ ·å¼ -->

  <!-- åˆ†ç±»æ ‡é¢˜ -->
  <h2 class="section-title">ğŸ“˜ <%= page.category %> åˆ†ç±»</h2>
  <!-- emoji ğŸ“˜ ç”¨äºè§†è§‰å¢å¼º -->
  <!-- <%= page.category %> åŠ¨æ€è¾“å‡ºå½“å‰é¡µé¢æ‰€å±åˆ†ç±»åç§° -->
  <!-- æ˜¾ç¤ºç¤ºä¾‹ï¼šğŸ“˜ Java åˆ†ç±» -->

  <div class="post-list">
    <!-- æ–‡ç« åˆ—è¡¨å®¹å™¨ï¼Œç”¨äºæ”¾ç½®æ–‡ç« å¡ç‰‡ -->

    <% if (page.posts && page.posts.length) { %>
    <!-- åˆ¤æ–­å½“å‰åˆ†ç±»ä¸‹æ˜¯å¦æœ‰æ–‡ç«  -->
    <!-- page.posts â†’ å½“å‰é¡µé¢æ–‡ç« æ•°ç»„ -->
    <!-- page.posts.length â†’ æ–‡ç« æ•°é‡ï¼Œå¤§äº 0 åˆ™è¿›å…¥å¾ªç¯ -->

      <% page.posts.each(function(post) { %>
      <!-- éå†å½“å‰åˆ†ç±»ä¸‹æ¯ç¯‡æ–‡ç«  post -->
      <!-- post å¯¹è±¡åŒ…å«æ–‡ç« æ ‡é¢˜ã€è·¯å¾„ã€æ—¥æœŸã€åˆ†ç±»ã€æ ‡ç­¾ã€æ‘˜è¦ç­‰ä¿¡æ¯ -->

      <!-- å•ç¯‡æ–‡ç« å¡ç‰‡ -->
      <article class="post-card">
        <!-- post-card çš„å†…å®¹ï¼ˆæ ‡é¢˜/ç›¸å…³ä¿¡æ¯/æ‘˜è¦ï¼‰ -->
        <h3 class="post-title">
          <a href="<%= url_for(post.path) %>"><%= post.title %></a>
        </h3>
        <p class="post-meta">
          å‘å¸ƒäº <%= date(post.date, 'YYYY-MM-DD') %>
        </p>
        <p class="post-excerpt">
          <%= post.excerpt
                ? post.excerpt.replace(/<[^>]+>/g, '').substring(0, 100) + '...'
                : 'ï¼ˆæš‚æ— æ‘˜è¦ï¼‰' %>
        </p>

        <!-- æŒ‰é’®å®¹å™¨ -->
        <div class="button-container">
          <!-- é˜…è¯»å…¨æ–‡æŒ‰é’® -->
          <a href="<%= url_for(post.path) %>" class="read-more">é˜…è¯»å…¨æ–‡</a>
          
          <!-- ç¼–è¾‘å…¨æ–‡æŒ‰é’® -->
          <a href="javascript:void(0)" class="edit-more" 
             onclick="openEditor({
               name: '<%= post.path.split('/').pop() %>',
               download_url: '<%= post.download_url %>',
             })">ç¼–è¾‘å…¨æ–‡</a>
        </div>
        <!-- æŒ‰é’®å®¹å™¨ç»“æŸ -->

      </article>
      <!-- å•ç¯‡æ–‡ç« å¡ç‰‡ç»“æŸ -->

      <% }); %>
      <!-- éå†æ–‡ç« ç»“æŸ -->

    <% } else { %>
    <!-- å½“å‰åˆ†ç±»æ²¡æœ‰æ–‡ç«  -->

      <p>è¯¥åˆ†ç±»ä¸‹æš‚æ— æ–‡ç« ã€‚</p>
      <!-- æç¤ºç”¨æˆ·è¯¥åˆ†ç±»æš‚æ—¶ä¸ºç©º -->

    <% } %>
    <!-- æ¡ä»¶åˆ¤æ–­ç»“æŸ -->

  </div>
  <!-- æ–‡ç« åˆ—è¡¨å®¹å™¨ç»“æŸ -->

</section>
<!-- é¡µé¢ä¸»å®¹å™¨ç»“æŸ -->

<script>
  // ========================
  // ç¼–è¾‘å™¨å‡½æ•°
  // ========================
  async function openEditor(file) {
    editingNote = file;
    try {
      const res = await fetch(file.download_url);
      const contentText = await res.text();
      const shaRes = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${postsDir}/${file.name}`);
      const shaData = await shaRes.json();
      editingNote.sha = shaData.sha;

      // ç¼–è¾‘å™¨å¡«å……
      document.getElementById('note-title').value = contentText.match(/title:\s*(.*)/)?.[1] || file.name;
      document.getElementById('note-category').value = contentText.match(/category:\s*(.*)/)?.[1] || "";
      document.getElementById('note-tags').value = contentText.match(/tags:\s*\[(.*)\]/)?.[1] || "";
      document.getElementById('note-content').value = contentText.split('---').slice(2).join('---').trim();

      document.getElementById('preview-div').innerHTML = marked.parse(document.getElementById('note-content').value);
      document.getElementById('editor-modal').style.display = "block";
    } catch (err) {
      alert("âŒ æ‰“å¼€ç¼–è¾‘å™¨å¤±è´¥ï¼š" + err.message);
    }
  }

  function closeEditor() {
    document.getElementById('editor-modal').style.display = "none";
  }
</script>

<style>
  /* æŒ‰é’®å®¹å™¨ */
  .button-container {
    display: flex;
    align-items: center;
  }

  /* é˜…è¯»å…¨æ–‡æŒ‰é’® */
  .read-more {
    display: inline-block;
    padding: 10px 15px;
    background-color: #007bff;
    color: #fff;
    text-decoration: none;
    border-radius: 5px;
    font-size: 14px;
    transition: background-color 0.3s ease;
  }
  .read-more:hover {
    background-color: #0056b3;
  }

  /* ç¼–è¾‘å…¨æ–‡æŒ‰é’® */
  .edit-more {
    display: inline-block;
    padding: 10px 15px;
    background-color: #28a745;
    color: #fff;
    text-decoration: none;
    border-radius: 5px;
    font-size: 14px;
    transition: background-color 0.3s ease;
    margin-left: auto; /* å°†æŒ‰é’®æ¨é€åˆ°æœ€å³ä¾§ */
  }
  .edit-more:hover {
    background-color: #1c7c31;
  }
</style>