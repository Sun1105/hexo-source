---
title: VBA工具
category: VBA
tags: [TOOL]
date: 2025-11-30T13:55:00.172Z
---

# VBA 工具宏说明文档

## **概述**
本 VBA 工具提供以下功能：
- **运行批处理文件**（如服务器启动脚本）
- **打开指定 Excel 工具文件**
- **记录错误日志**

该工具适用于自动化操作，减少手动执行命令和打开文件的工作量。

---

## **功能列表**

### **1. RunBat**
**功能**：运行指定文件夹中的批处理文件（`起動.bat`）  
**参数**：`folderPath` - 批处理文件所在的文件夹路径  

```vb

'-----------------------------------------------
' 功能：运行指定文件夹中的批处理文件（起動.bat）
' 参数：folderPath - 批处理文件所在的文件夹路径
'-----------------------------------------------
Public Sub RunBat(folderPath As String)
    Dim wsh As Object
    Dim batPath As String
    
    ' 拼接批处理文件完整路径
    batPath = folderPath & "\起動.bat"
    
    ' 判断文件是否存在
    If Dir(batPath) <> "" Then
        ' 创建 WScript.Shell 对象，用于执行命令行
        Set wsh = CreateObject("WScript.Shell")
        
        ' 使用 cmd.exe 打开命令行窗口，切换到指定目录并运行起動.bat
        ' /k 表示执行后保持窗口打开
        wsh.Run "cmd.exe /k ""cd /d " & folderPath & " & 起動.bat""", 1, True
    Else
        ' 文件不存在时弹出提示框，并记录错误日志
        MsgBox "文件不存在：" & batPath, vbExclamation
        LogError "文件不存在：" & batPath
    End If
End Sub


'-----------------------------------------------
' 功能：打开指定路径的 Excel 文件
' 参数：relativePath - 相对路径（相对于当前工作簿路径）
'-----------------------------------------------
Public Sub OpenExcelTool(relativePath As String)
    Dim filePath As String
    
    ' 拼接 Excel 文件完整路径
    filePath = ThisWorkbook.Path & "\" & relativePath
    
    ' 判断文件是否存在
    If Dir(filePath) <> "" Then
        ' 打开 Excel 文件
        Workbooks.Open filePath
    Else
        ' 文件不存在时弹出提示框，并记录错误日志
        MsgBox "Excel 文件不存在：" & filePath, vbExclamation
        LogError "Excel 文件不存在：" & filePath
    End If
End Sub


'-----------------------------------------------
' 功能：记录错误信息到日志文件
' 参数：errorMsg - 错误信息
'-----------------------------------------------
Public Sub LogError(errorMsg As String)
    Dim logFile As String
    Dim fNum As Integer
    
    ' 日志文件路径（与当前工作簿同目录）
    logFile = ThisWorkbook.Path & "\ErrorLog.txt"
    
    ' 获取空闲文件号
    fNum = FreeFile
    
    ' 以追加模式打开日志文件，并写入当前时间和错误信息
    Open logFile For Append As #fNum
    Print #fNum, Now & " - " & errorMsg
    Close #fNum
End Sub


'-----------------------------------------------
' 功能：运行服务器工具的批处理文件
'-----------------------------------------------
Public Sub RunServerBat()
    ' 调用 RunBat 方法，传入服务器工具路径
    RunBat "C:\Users\Desktop\TOOL\ServerTool"
End Sub


'-----------------------------------------------
' 功能：打开 ITA 测试工具 Excel 文件
'-----------------------------------------------
Public Sub OpenITATestTool()
    ' 调用 OpenExcelTool 方法，传入 ITA 测试工具相对路径
    OpenExcelTool "TOOL\ITATestTool\ITaTestTool.xlsm"
End Sub
