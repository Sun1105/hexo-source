---
title: 单体测试执行类_模板
date: 2026-02-05T14:24:48.362Z
categories: [JUnit]
tags: [执行类]
---

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>単体テスト詳細設計書 - test0001</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'neutral',
            flowchart: { useMaxWidth: false, htmlLabels: true }
        });
    </script>
    <style>
        :root {
            --sier-blue: #003366;
            --sier-light: #f0f4f8;
            --zh-accent: #0056b3;
            --code-bg: #282c34;
        }

        body {
            font-family: "Meiryo", "MS PGothic", "Microsoft YaHei", sans-serif;
            background-color: #f5f5f5;
            color: #333;
            margin: 0;
            padding: 40px 20px;
        }

        .doc-container {
            max-width: 1100px;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-top: 6px solid var(--sier-blue);
        }

        .header {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid var(--sier-blue);
            margin-bottom: 30px;
            padding-bottom: 10px;
        }

        h1 { color: var(--sier-blue); font-size: 24px; margin: 0; }
        h1 .zh-title { display: block; font-size: 18px; color: var(--zh-accent); margin-top: 5px; }

        h2 { border-left: 5px solid var(--sier-blue); padding-left: 15px; font-size: 18px; margin-top: 30px; background: var(--sier-light); padding-top: 5px; padding-bottom: 5px; }
        h2 .zh-sub { font-size: 14px; color: var(--zh-accent); margin-left: 10px; font-weight: normal; }

        .bilingual-text { margin-bottom: 10px; }
        .lang-jp { font-weight: bold; display: block; }
        .lang-zh { color: var(--zh-accent); display: block; font-size: 0.9em; margin-top: 2px; }

        /* 代码高亮 */
        pre {
            background: var(--code-bg);
            color: #abb2bf;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            overflow-x: auto;
            line-height: 1.5;
        }
        .keyword { color: #c678dd; }
        .comment { color: #5c6370; }
        .anno { color: #d19a66; }

        .mermaid-box {
            background: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
        th, td { border: 1px solid #ccc; padding: 12px; }
        th { background: #f8f9fa; color: var(--sier-blue); }
        .col-jp { font-weight: bold; }
        .col-zh { color: var(--zh-accent); font-size: 0.85em; display: block; margin-top: 4px; }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            background: var(--sier-blue);
            color: white;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

<div class="doc-container">
    <div class="header">
        <div>
            <span class="badge">Unit Test Spec / 单体测试规格</span>
            <h1>
                単体テスト詳細設計書：test0001
                <span class="zh-title">单体测试详细设计书：test0001</span>
            </h1>
        </div>
        <div style="text-align: right; font-size: 12px;">
            作成日 / 作成日期: 2026-02-05<br>
            対象クラス / 对象类: Application1.java
        </div>
    </div>

    <h2>1. テスト環境・コンテキスト構成 <span class="zh-sub">测试环境与上下文配置</span></h2>
    <div class="bilingual-text">
        <span class="lang-jp">Spring Test Context を利用し、以下のコンポーネントをスキャン・注入する。</span>
        <span class="lang-zh">利用 Spring Test Context 扫描并注入以下组件。</span>
    </div>
    <table>
        <tr>
            <th>項目 / 项目</th>
            <th>内容</th>
        </tr>
        <tr>
            <td class="col-jp">Config / Initializer <span class="col-zh">配置与初始化器</span></td>
            <td>TestConfig.class, ConfigDataApplicationContextInitializer</td>
        </tr>
        <tr>
            <td class="col-jp">Scan Target <span class="col-zh">扫描对象类</span></td>
            <td>Log, Application1, Service2, Component3, Component4, Component5</td>
        </tr>
        <tr>
            <td class="col-jp">Extensions <span class="col-zh">扩展组件</span></td>
            <td>OutputCaptureExtension (標準出力検証用 / 标准输出验证), LogTest (ログ検証用 / 日志验证)</td>
        </tr>
    </table>

    <h2>2. モック・スパイ定義 (Mock/Spy) <span class="zh-sub">Mock 与 Spy 定义</span></h2>
    
    

    <table>
        <thead>
            <tr>
                <th>定義タイプ / 定义类型</th>
                <th>物理名 / 变量名</th>
                <th>役割 / 作用</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>@MockitoSpyBean</code></td>
                <td>mockKkbaza0300Mapper</td>
                <td class="col-jp">実Mapperをベースに、特定のメソッドのみ挙動を制御する。<span class="col-zh">基于真实 Mapper，仅控制特定方法的行为。</span></td>
            </tr>
            <tr>
                <td><code>@MockitoBean</code></td>
                <td>common01Service</td>
                <td class="col-jp">共通サービスを完全なモックとして定義する。<span class="col-zh">将共通服务定义为完全模拟的 Mock。</span></td>
            </tr>
        </tbody>
    </table>

    <h2>3. 特殊制御：非同期シグナルフラグ更新 <span class="zh-sub">特殊控制：异步信号标志更新</span></h2>
    <div class="bilingual-text">
        <span class="lang-jp"><code>@BeforeEach</code> 内で、テスト実行中に <code>testService</code> の内部フラグを非同期で <code>true</code> に変更する制御を行う。</span>
        <span class="lang-zh">在 <code>@BeforeEach</code> 中，实现在测试执行期间异步地将 <code>testService</code> 内部标志设为 <code>true</code> 的控制逻辑。</span>
    </div>
    
    <div class="mermaid-box">
        <div class="mermaid">
            sequenceDiagram
                participant T as Test Main Thread (主线程)
                participant B as Child Thread (子线程)
                participant S as testService
                
                T->>B: Start Thread (@BeforeEach)
                T->>T: Execute @Test (UT_TEST_01)
                Note over B: Sleep 2000ms (等待)
                B->>S: Reflection: signalFlg = true (反射更新)
                Note over T: Service logic detects flag (业务感知)
        </div>
    </div>

    <h2>4. テストソースコード (Source Code) <span class="zh-sub">测试源代码</span></h2>
    <pre><code>@SpringJUnitConfig(
    classes = {
        TestConfig.class,
        Log.class,
        Application1.class,
        Service2.class,
        Component3.class,
        Component4.class,
        Component5.class
    },
    initializers = ConfigDataApplicationContextInitializer.class
)
@ExtendWith(OutputCaptureExtension.class)
@ExtendWith(LogTest.class)
public class test0001 {

    /** テスト対象 */
    @Autowired
    private Application application;

    @Autowired
    private TESTService testService;

    /** Mapper */
    @MockitoSpyBean
    private KKBAZA0300Mapper mockKkbaza0300Mapper;

    /** 共通サービス */
    @MockitoBean
    private COMMON01Service common01Service;

    /** システム日時 */
    private static final String SYSTEM_DATE = "20250102121314";

    /** シェルID */
    private static final String SHELL_ID = "ABC12";

    /**
     * 事前処理
     */
    @BeforeEach
    void setup() {
        // モック初期化
        MockitoAnnotations.openMocks(this);

        // 非同期で signalFlg を true に設定
        new Thread(() -> {
            try {
                Thread.sleep(2000);
                ReflectionTestUtils.setField(testService, "signalFlg", true);
            } catch (InterruptedException e) {
                // 例外は無視
            }
        }).start();
    }

    @AfterEach
    void teardown() {
        // 後処理（必要に応じて実装）
    }

    /**
     * テストケース: UT_TEST_01
     *
     * @throws InterruptedException
     */
    @Test
    @DirtiesContext(methodMode = DirtiesContext.MethodMode.AFTER_METHOD)
    @Sql(scripts = "classpath:UT_TEST_01.sql")
    void UT_TEST_01(CapturedOutput output) throws InterruptedException {
        // モック設定
        // データ連携
        // イメージ連携
        // SYRIUS稼働状況区分取得サービス

        // 期待値
        String expectedValue1 = "1";

        // テスト実行
        this.application.perform(SHELL_ID);

        // 確認値
        String resultValue1 = "";

        // 検証
        assertEquals(expectedValue1, resultValue1);
    }
}</code></pre>

    <h2>5. テストケース一覧 (Test Matrix) <span class="zh-sub">测试用例矩阵</span></h2>
    <table>
        <thead>
            <tr>
                <th>Case ID</th>
                <th>テスト目的 / 测试目的</th>
                <th>事前データ / 准备数据 (SQL)</th>
                <th>期待結果 / 预期结果</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>UT_TEST_01</td>
                <td class="col-jp">シェルID 'ABC12' 指定時の正常系動作確認<span class="col-zh">指定 Shell ID 'ABC12' 时的正常系动作确认</span></td>
                <td>UT_TEST_01.sql</td>
                <td class="col-jp">指定された期待値と結果値が一致すること。<span class="col-zh">指定的预期值与结果值需一致。</span></td>
            </tr>
        </tbody>
    </table>

    <div style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 10px; color: #999; font-size: 11px; text-align: center;">
        &copy; 2026 SIer Project QA Team - For Internal Use Only / 内部限阅
    </div>
</div>

</body>
</html>