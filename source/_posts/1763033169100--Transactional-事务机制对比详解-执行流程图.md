---
title: ⚙️ @Transactional 事务机制对比详解    执行流程图
category: SpringBoot
tags: [流程图, 注解说明]
date: 2025-11-14T14:12:15.161Z
---

# ⚙️ @Transactional 事务机制对比详解

## 🧩 一、无 `@Transactional` 的情况（默认 JDBC 自动提交）

```text
┌──────────────────────────┐
│ 调用 service.method()                              │
└────────────┬─────────────┘
             │
             ▼
     ┌────────────────┐
     │ 执行 SQL 1     │
     ├────────────────┤
     │ JDBC 自动提交  │  ← autoCommit = true
     └────────────────┘
             │
             ▼
     ┌────────────────┐
     │ 执行 SQL 2     │
     ├────────────────┤
     │ JDBC 自动提交  │  ← 每条 SQL 都立即 commit
     └────────────────┘
             │
             ▼
     ┌────────────────┐
     │ 出现异常 ❌     │
     └────────────────┘
             │
             ▼
❗ **结果：**
- SQL1 已提交  
- SQL2 已提交  
- 无法回滚
```

> 🧠 **解释：**
> 没有事务时，JDBC 默认 `autoCommit = true`，每条 SQL 都是独立提交的，异常不会影响之前的操作。

---

## ✅ 二、有 `@Transactional` 的情况（Spring 事务代理）

```text
┌──────────────────────────┐
│              调用 @Transactional 方法              │
└────────────┬─────────────┘
                          │
                          ▼
     ┌──────────────────────────────┐
     │ Spring 创建事务                                            │
     │ (autoCommit = false)                                       │
     └──────────────────────────────┘
             │
             ▼
     ┌────────────────┐
     │ 执行 SQL 1                     │
     ├────────────────┤
     │ 不提交 (暂存)                  │
     └────────────────┘
             │
             ▼
     ┌────────────────┐
     │ 执行 SQL 2                     │
     ├────────────────┤
     │ 不提交 (暂存)                  │
     └────────────────┘
             │
             ▼
     ┌────────────────┐
     │ 逻辑执行结束                   │
     └────────────────┘
             │
             ▼
     ┌────────────────┐
     │ 判断是否异常                   │
     └────────────────┘
          ┌─────────────┬─────────────┐
          ▼                                                      ▼
    ✅ 正常结束                                            ❌ 出现异常
┌────────────────┐         ┌────────────────┐
│ Spring 提交事务                │         │ Spring 回滚事务                │
└────────────────┘         └────────────────┘
```

**结果总结：**

* ✅ 正常情况 → 所有 SQL 一起 **commit**
* ❌ 异常情况 → 所有 SQL 全部 **rollback**

---

## 🧭 三、两者核心区别总结

| 项目              | 无 @Transactional | 有 @Transactional           |
| --------------- | ---------------- | -------------------------- |
| 事务是否开启          | 否                | 是                          |
| JDBC autoCommit | `true`           | `false`                    |
| 提交时机            | 每条 SQL 立即提交      | 方法执行完统一提交                  |
| 异常回滚            | 不会               | 会（默认回滚 `RuntimeException`） |
| 数据一致性           | 无法保证             | 可以保证                       |

---

## 💡 补充说明

> **@Transactional 生效条件：**
>
> * ✅ 类或方法必须被 **Spring 容器管理**（即是 Bean）。
> * ✅ 方法必须是 **public**。
> * ⚠️ **自调用（同类内部互调）** 不经过代理，不会触发事务。
