---
title: VBA工具
category: VBA
tags: [VBA]
date: 2025-12-12T11:07:15.892Z
---

■Excel
シート名：1
想定項目	実施項目	想定値	実施値

シート名：2
実施項目	実施値


■マクロ

1,在 Excel 按 Alt + F11 打开 VBA 编辑器。
2,在左侧工程窗格找到放置 CommandButton 的工作表（例如 Sheet2）。双击打开。
3,选择对象下拉框选 CommandButton1，过程下拉框选 Click（编辑器会自动生成事件框架）。
4.在事件里调用你的处理：
Private Sub CommandButton1_Click()
 Call FillItemsAndValues
End Sub

注意：这是工作表代码模块（不是标准模块）。事件名必须与按钮名称一致（比如 CommandButton1_Click）。如果你的按钮名不是 CommandButton1，请在设计模式下选中按钮，在属性窗口把 Name 看清楚或改成一致。


■VBA

Option Explicit

'——键值清洗：去前后半角空格、去全角空格（必要时可加大小写统一）
Private Function CleanKey(ByVal v As Variant) As String
    Dim s As String
    s = CStr(v)
    s = Replace(s, ChrW(12288), "")  ' 全角空格
    s = Trim(s)                      ' 半角前后空格
    ' 若需要忽略大小写，可启用下一行：
    ' s = UCase$(s)
    CleanKey = s
End Function

Public Sub FillItemsAndValues()
    Dim wsSrc As Worksheet, wsTgt As Worksheet
    Dim lastSrc As Long, lastTgt As Long
    Dim r As Long
    Dim dict As Object
    Dim k As String
    Dim itemName As Variant, itemValue As Variant
    
    ' —— 工作表（按你的文件名）
    Set wsTgt = ThisWorkbook.Sheets("1") ' 黄色：A=想定項目，B=受信項目，D=受信値
    Set wsSrc = ThisWorkbook.Sheets("2") ' 白色：A=送信項目(实施项目)，B=送信値(实施值)
    
    lastSrc = wsSrc.Cells(wsSrc.Rows.Count, 1).End(xlUp).Row
    lastTgt = wsTgt.Cells(wsTgt.Rows.Count, 1).End(xlUp).Row
    
    ' —— 字典：key=来源A（实施项目），value=数组 [实施项目, 实施值]
    Set dict = CreateObject("Scripting.Dictionary")
    
    For r = 2 To lastSrc
        k = CleanKey(wsSrc.Cells(r, 1).Value)     ' 实施项目（键）
        If Len(k) > 0 Then
            itemName = wsSrc.Cells(r, 1).Value     ' 2!A
            itemValue = wsSrc.Cells(r, 2).Value    ' 2!B（保留原始类型）
            dict(k) = Array(itemName, itemValue)
        End If
    Next r
    
    Application.ScreenUpdating = False
    Application.Calculation = xlCalculationManual
    
    ' —— 按 1!A（想定項目）匹配；命中后写 1!B（受信項目）、1!D（受信値）
    For r = 2 To lastTgt
        k = CleanKey(wsTgt.Cells(r, 1).Value)  ' 1!A 想定項目
        If dict.Exists(k) Then
            wsTgt.Cells(r, 2).Value = dict(k)(0)   ' 1!B ← 2!A（实施项目）
            wsTgt.Cells(r, 4).Value = dict(k)(1)   ' 1!D ← 2!B（实施值）
        End If
    Next r
    
    Application.Calculation = xlCalculationAutomatic
    Application.ScreenUpdating = True
    
    MsgBox "完成：2!A→1!B，2!B→1!D（按 A 列键匹配）", vbInformation
End Sub
